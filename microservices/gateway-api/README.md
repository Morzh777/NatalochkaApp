# Gateway API

Централизованный шлюз для маршрутизации HTTP-запросов к внутренним микросервисам, связанным с обработкой нумерологических данных. Реализует паттерн API Gateway для Telegram-бота и других клиентов.

## Основные возможности

- Приём всех внешних запросов от клиентов
- Проксирование запросов к микросервисам (db-api, numerology-api, description-api)
- Агрегация и предварительная обработка данных
- Единая точка входа для всех API
- Маршрутизация, валидация и обработка ошибок на уровне шлюза
- Документирование API через Swagger
- Высокая производительность благодаря Fastify

## Технологический стек

- **Node.js 20+** — серверная платформа
- **NestJS 11+** — фреймворк для построения масштабируемых серверных приложений
- **TypeScript** — типизированный JavaScript
- **Fastify** — высокопроизводительный HTTP-сервер
- **Axios** — HTTP-клиент для проксирования запросов к микросервисам
- **Swagger** — автогенерация и документация API
- **RxJS** — реактивное программирование
- **Docker** — контейнеризация и деплой
- **ESLint, Prettier** — поддержка качества и стиля кода
- **Jest** — тестирование

## Структура проекта

- `src/gateway/` — контроллер, сервис и типы шлюза
- `src/services/` — вспомогательные сервисы (работа с БД, расчёты)
- `src/utils/` — утилиты (проксирование HTTP-запросов)
- `src/config/` — конфигурация маршрутов и адресов микросервисов
- `src/main.ts` — точка входа
- `src/app.module.ts` — основной модуль приложения

## Быстрый старт

1. **Установите Node.js 20+ и npm**
2. **Установите зависимости:**
   ```bash
   npm install
   ```
3. **Запустите в режиме разработки:**
   ```bash
   npm run start:dev
   ```
4. **Соберите проект:**
   ```bash
   npm run build
   ```
5. **Запустите собранное приложение:**
   ```bash
   npm run start:prod
   ```

## Переменные окружения

- Обычно не требуется, если все микросервисы доступны по стандартным адресам (см. `src/config/routes.ts`).
- Для Docker Compose адреса сервисов задаются через алиасы контейнеров.

## Основные эндпоинты

Все маршруты начинаются с `/api`:

- `POST /api/calculate` — расчёт квадрата Пифагора
- `POST /api/matrix/destiny` — расчёт матрицы судьбы
- `POST /api/matrix` — создание матрицы судьбы
- `GET /api/matrix` — получение матрицы по дате рождения
- `POST /api/matrix_history` — сохранение матрицы в историю
- `GET /api/history/paginated` — история расчётов пользователя (пагинация)
- `GET /api/compatibility/history` — история совместимости пользователя (пагинация)
- `GET /api/matrix_history/paginated` — история матриц судьбы (пагинация)
- `GET /api/premium/:userId` — статус премиум-доступа
- `POST /api/premium/:userId/redeem` — активация премиум-кода
- `GET /api/description/program/:key` — описание программы судьбы
- `GET /api/description/:type/:num` — универсальный эндпоинт для описаний по типу и числу
- `POST /api/compatibility/batch` — пакетная совместимость
- `GET /api/users/active` — список активных пользователей

## Скрипты npm

- `npm run start:dev` — запуск в режиме разработки
- `npm run build` — сборка проекта
- `npm run start:prod` — запуск собранного приложения
- `npm run lint` — проверка кода линтером
- `npm run format` — автоформатирование кода
- `npm run test` — запуск тестов

## Контакты

by Morzh  
@: kla_atu@mail.ru

---
