import {BotContext} from "../bot/BotSettings.js";
import axios from "axios";
import {API_BASE_URL} from "../config/api.js";
import {sendPhotoWithCaption} from "../services/ImageService.js";

/**
 * üîê –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞.
 * –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.
 *
 * @returns true, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø –µ—Å—Ç—å, –∏–Ω–∞—á–µ false
 */
export async function checkPremiumAccess(ctx: BotContext): Promise<boolean> {
    const userId = ctx.from?.id;
    if (!userId) return false;

    try {
        const { data } = await axios.get<{ isActive: boolean }>(
            `${API_BASE_URL}/premium/${userId}`
        );

        return !!data.isActive;
    } catch (err) {
        console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–¥–ø–∏—Å–∫–∏:", err);
        return false;
    }
}

export async function showPremiumPitch(ctx: BotContext) {
    const caption = `
‚ú® <b>–•–æ—á–µ—à—å –ø–æ–Ω—è—Ç—å —Å–µ–±—è –≥–ª—É–±–∂–µ –∏ –∏–∑–º–µ–Ω–∏—Ç—å –∂–∏–∑–Ω—å?</b>

üß¨ <b>–ú–∞—Ç—Ä–∏—Ü–∞ —Å—É–¥—å–±—ã</b> ‚Äî –ø–æ–∫–∞–∂–µ—Ç —Ç–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã,  
–≤–ª–∏—è—é—â–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Å–∫—Ä—ã—Ç—ã–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

üéØ <b>–¶–µ–ª—å –∏ –ø—É—Ç—å:</b>  
‚Ä¢ –ß—Ç–æ —Ç–≤–æ—è –¥—É—à–∞ —Ö–æ—á–µ—Ç –ø—Ä–æ–π—Ç–∏  
‚Ä¢ –ö–∞–∫ —Ä–∞—Å–∫—Ä—ã—Ç—å —Å–≤–æ–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª

üí∞ <b>–§–∏–Ω–∞–Ω—Å—ã –∏ —Ä–∞–±–æ—Ç–∞:</b>  
‚Ä¢ –ì–¥–µ —Ç–µ—Ä—è–µ—Ç—Å—è —ç–Ω–µ—Ä–≥–∏—è –∏ –¥–µ–Ω—å–≥–∏  
‚Ä¢ –ö–∞–∫ –Ω–∞–π—Ç–∏ –¥–µ–ª–æ –ø–æ –¥—É—à–µ –∏ –≤—ã–π—Ç–∏ –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å

üíû <b>–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:</b>  
‚Ä¢ –ü–æ—á–µ–º—É –≤–∞—Å —Ç—è–Ω–µ—Ç ‚Äî –∏–ª–∏ –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–µ—Ç  
‚Ä¢ –ß—Ç–æ –º–µ—à–∞–µ—Ç –≥–∞—Ä–º–æ–Ω–∏–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö  
‚Ä¢ –ö–∞–∫ —Å—Ç–∞—Ç—å –±–ª–∏–∂–µ –∏ –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

‚≠ê <b>–ö—É–ø–∏ –¥–æ—Å—Ç—É–ø –≤—Å–µ–≥–æ –∑–∞ 99 –∑–≤—ë–∑–¥(üíµ 179 —Ä—É–±–ª–µ–π )  </b> ‚Äî –∏ —Ç—ã –æ—Ç–∫—Ä–æ–µ—à—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —ç—Ç–∏–º —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞–º.
`.trim();

    await sendPhotoWithCaption(ctx, "premium_matrix", caption, {
        inline_keyboard: [
            [{ text: "üí´ –ö—É–ø–∏—Ç—å –¥–æ—Å—Ç—É–ø –Ω–∞ 30 –¥–Ω–µ–π", callback_data: "buy_premium" }],
            [{ text: "‚≠ê –ö—É–ø–∏—Ç—å –∑–≤–µ–∑–¥—ã —Å–æ —Å–∫–∏–¥–∫–æ–π", url: "https://t.me/PremiumBot" }],
            [{ text: "üîô –ù–∞–∑–∞–¥", callback_data: "menu" }],
        ]
    });
}
